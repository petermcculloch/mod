{
	"patcher" : 	{
		"fileversion" : 1,
		"appversion" : 		{
			"major" : 7,
			"minor" : 2,
			"revision" : 3,
			"architecture" : "x86",
			"modernui" : 1
		}
,
		"rect" : [ 345.0, 78.0, 901.0, 621.0 ],
		"editing_bgcolor" : [ 0.9, 0.9, 0.9, 1.0 ],
		"bglocked" : 0,
		"openinpresentation" : 0,
		"default_fontsize" : 12.0,
		"default_fontface" : 0,
		"default_fontname" : "Arial",
		"gridonopen" : 1,
		"gridsize" : [ 15.0, 15.0 ],
		"gridsnaponopen" : 1,
		"objectsnaponopen" : 1,
		"statusbarvisible" : 2,
		"toolbarvisible" : 1,
		"lefttoolbarpinned" : 0,
		"toptoolbarpinned" : 0,
		"righttoolbarpinned" : 0,
		"bottomtoolbarpinned" : 0,
		"toolbars_unpinned_last_save" : 0,
		"tallnewobj" : 0,
		"boxanimatetime" : 200,
		"enablehscroll" : 1,
		"enablevscroll" : 1,
		"devicewidth" : 0.0,
		"description" : "",
		"digest" : "",
		"tags" : "",
		"style" : "",
		"subpatcher_template" : "",
		"boxes" : [ 			{
				"box" : 				{
					"id" : "obj-6",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 745.0, 546.0, 37.0, 22.0 ],
					"style" : "",
					"text" : "out 2"
				}

			}
, 			{
				"box" : 				{
					"code" : "History ref_sig(0.);\r\nHistory phs_accum(0.);\r\nHistory phs_inc(0.);\r\nHistory diff_smooth(0.);\r\nHistory out_smooth(0.);\r\nHistory pulse_count(0.);\r\nHistory freq_out(80.);\r\nHistory prev_freq(80.);\r\nHistory diff(0.);\r\nParam reference_frequency(80., min = 0.00001, max = 10000.); \r\nParam loop_gain(1.,min=0.000001);\r\nParam diff_cutoff(50, min=0.001, max = 20000.);\r\nParam output_cutoff(5000,min=0.001,max=20000.);\r\nParam bang_bang(0,min=0,max=1);\r\ncutoff_mult = twopi/samplerate;\r\na0 = sin(diff_cutoff * cutoff_mult);\r\nb1 = a0-1;\r\nout_a0 = sin(output_cutoff * cutoff_mult);\r\nout_b1 = out_a0 - 1;\r\n\r\n// Use either bang_bang or continuous phase detection (or possibly a blend...)\r\ndiff = (bang_bang * ((in1 > 0) - (ref_sig > 0))) + (!bang_bang * (in1 - ref_sig));\r\n\r\ndiff_smooth = diff*a0 + diff_smooth * b1;\r\ndiff_smooth = diff*a0 + diff_smooth * b1;\r\ndiff_smooth = diff*a0 + diff_smooth * b1;\r\ndiff_smooth = diff*a0 + diff_smooth * b1;\r\n\r\n\r\nphs_inc = (loop_gain * diff_smooth) + (reference_frequency/samplerate);\r\nphs_accum += phs_inc;\r\nref_sig = cos(phs_accum);\r\n\r\nout_smooth = out_a0 * ref_sig - out_smooth*out_b1; \r\nout_smooth = out_a0 * ref_sig - out_smooth*out_b1; \r\n\r\nraw_pulse = (out_smooth > 0.);\r\ndo_reset = delta(raw_pulse) > 0.;\r\nfreq_out = do_reset ? samplerate / pulse_count : freq_out;\r\npulse_count = (pulse_count + 1)*(1-do_reset);\r\n\r\nout1 = dcblock(out_smooth);\r\nout2 = freq_out;\r\n",
					"fontface" : 0,
					"fontname" : "Arial",
					"fontsize" : 12.0,
					"id" : "obj-5",
					"maxclass" : "codebox",
					"numinlets" : 1,
					"numoutlets" : 2,
					"outlettype" : [ "", "" ],
					"patching_rect" : [ 50.0, 129.0, 714.0, 401.0 ],
					"style" : ""
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-1",
					"maxclass" : "newobj",
					"numinlets" : 0,
					"numoutlets" : 1,
					"outlettype" : [ "" ],
					"patching_rect" : [ 50.0, 14.0, 30.0, 22.0 ],
					"style" : "",
					"text" : "in 1"
				}

			}
, 			{
				"box" : 				{
					"id" : "obj-4",
					"maxclass" : "newobj",
					"numinlets" : 1,
					"numoutlets" : 0,
					"patching_rect" : [ 50.0, 551.0, 37.0, 22.0 ],
					"style" : "",
					"text" : "out 1"
				}

			}
 ],
		"lines" : [ 			{
				"patchline" : 				{
					"destination" : [ "obj-5", 0 ],
					"disabled" : 0,
					"hidden" : 0,
					"source" : [ "obj-1", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-4", 0 ],
					"disabled" : 0,
					"hidden" : 0,
					"source" : [ "obj-5", 0 ]
				}

			}
, 			{
				"patchline" : 				{
					"destination" : [ "obj-6", 0 ],
					"disabled" : 0,
					"hidden" : 0,
					"source" : [ "obj-5", 1 ]
				}

			}
 ],
		"autosave" : 0
	}

}
